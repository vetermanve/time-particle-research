# –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ 30.4: "–ö–≤–∞—Ä–∫–∏ –∫–∞–∫ —Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–æ–Ω–æ–≤"

## üéØ **–¶–µ–ª—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É, —á—Ç–æ **–∫–≤–∞—Ä–∫–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–æ–Ω–æ–≤**, –∞ **–∞–¥—Ä–æ–Ω—ã ‚Äî –∫–∞–∫ —Ç—Ä–æ–π–∫–∏ –∫–≤–∞—Ä–∫–æ–≤**.

## üìã **–ü–ª–∞–Ω —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞:**

### **–≠—Ç–∞–ø 1: –ü—Ä–µ–æ–Ω—ã (–Ω–∏—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏)**
- –ö–∞–∂–¥—ã–π –ø—Ä–µ–æ–Ω –∏–º–µ–µ—Ç **–¥—Ä–æ–±–Ω—ã–π –∑–∞—Ä—è–¥**: -1/3 –∏–ª–∏ +2/3
- –ö–∞–∂–¥—ã–π –ø—Ä–µ–æ–Ω –∏–º–µ–µ—Ç **—Ü–≤–µ—Ç**: R, G –∏–ª–∏ B
- –ö–∞–∂–¥—ã–π –ø—Ä–µ–æ–Ω –∏–º–µ–µ—Ç **—Ä–µ–∑–æ–Ω–∞–Ω—Å–Ω—ã–π –∫–æ–¥** (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π 5D)

### **–≠—Ç–∞–ø 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–µ–æ–Ω–æ–≤ –≤ –∫–≤–∞—Ä–∫–∏**
- –ö–≤–∞—Ä–∫ = **3 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–æ–Ω–∞**
- –ó–∞—Ä—è–¥ –∫–≤–∞—Ä–∫–∞ = —Å—É–º–º–∞ –∑–∞—Ä—è–¥–æ–≤ –ø—Ä–µ–æ–Ω–æ–≤ (¬±2/3 –∏–ª–∏ ¬±1/3)
- –¶–≤–µ—Ç –∫–≤–∞—Ä–∫–∞ = –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π —Ü–≤–µ—Ç –ø—Ä–µ–æ–Ω–æ–≤ (R, G –∏–ª–∏ B)

### **–≠—Ç–∞–ø 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–≤–∞—Ä–∫–æ–≤ –≤ –∞–¥—Ä–æ–Ω—ã**
- –ê–¥—Ä–æ–Ω = **3 –∫–≤–∞—Ä–∫–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏** (R+G+B = –±–µ–ª—ã–π)
- –ó–∞—Ä—è–¥ –∞–¥—Ä–æ–Ω–∞ = —Å—É–º–º–∞ –∑–∞—Ä—è–¥–æ–≤ –∫–≤–∞—Ä–∫–æ–≤ (-1, 0, +1, +2)
- –ú–∞—Å—Å–∞ –∞–¥—Ä–æ–Ω–∞ = —Å—É–º–º–∞ –º–∞—Å—Å –∫–≤–∞—Ä–∫–æ–≤ + —ç–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏

### **–≠—Ç–∞–ø 4: –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –º–∞—Å—Å**
- –í–≤–µ—Å—Ç–∏ –º–∞—Å—à—Ç–∞–±–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –º–∞—Å—Å–∞–º (–ú—ç–í)
- –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —á–∞—Å—Ç–∏—Ü–∞–º–∏: –ø—Ä–æ—Ç–æ–Ω (938), –Ω–µ–π—Ç—Ä–æ–Ω (940), –ø–∏–æ–Ω (140)

## üöÄ **–ö–æ–¥ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ 30.4:**

```python
"""
–≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ ‚Ññ30.4 ‚Äî –ö–í–ê–†–ö–ò –ö–ê–ö –¢–†–û–ô–ö–ò –ü–†–ï–û–ù–û–í
"""

import numpy as np
import random
import math
import json
import time
import matplotlib.pyplot as plt
from datetime import datetime
import os
from itertools import combinations
from collections import defaultdict, Counter

# ================= –ö–û–ù–°–¢–ê–ù–¢–´ =================
EXPERIMENT_NUMBER = 30
VERSION = "30.4"
TIMESTAMP = datetime.now().strftime("%Y%m%d_%H%M%S")
RESULT_DIR = f"experiment_{EXPERIMENT_NUMBER}_{VERSION}_{TIMESTAMP}"
os.makedirs(RESULT_DIR, exist_ok=True)

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
NUM_PREONS = 1000      # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–æ–Ω–æ–≤
CODE_DIM = 5           # –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –∫–æ–¥–∞
MAX_PAIRS_CHECK = 50000 # –ü—Ä–æ–≤–µ—Ä–æ–∫ –ø–∞—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
MIN_SYNC_STRENGTH = 0.25 # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
MASS_SCALE = 10.0      # –ú–∞—Å—à—Ç–∞–± –º–∞—Å—Å (–¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏)

class Preon:
    """–ü–†–ï–û–ù ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–∏"""
    
    def __init__(self, preon_id: int, dimension: int = 5):
        self.id = preon_id
        self.dimension = dimension
        
        # –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–µ–æ–Ω–∞
        self.charge = random.choice([-1/3, 2/3])  # –î—Ä–æ–±–Ω—ã–π –∑–∞—Ä—è–¥
        self.color = random.choice(['R', 'G', 'B'])  # –¶–≤–µ—Ç
        
        # –†–µ–∑–æ–Ω–∞–Ω—Å–Ω—ã–π –∫–æ–¥ (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π)
        self.code = self._generate_complex_code()
        
        # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        self.phase = random.uniform(0, 2 * math.pi)
        self.amplitude = random.uniform(0.8, 1.2)
        self.frequency = self._calculate_base_frequency()
        
        # –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞
        self.base_mass = random.uniform(0.5, 2.0)  # –ë–∞–∑–æ–≤–∞—è –º–∞—Å—Å–∞ –ø—Ä–µ–æ–Ω–∞
        self.spin_direction = random.choice([-0.5, 0.5])
        
        # –°–æ—Å—Ç–æ—è–Ω–∏—è
        self.sync_partners = set()
        self.in_quark = None  # ID –∫–≤–∞—Ä–∫–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –≤—Ö–æ–¥–∏—Ç
        
    def _generate_complex_code(self) -> list:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∫–æ–¥–∞ (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è + –º–Ω–∏–º–∞—è —á–∞—Å—Ç–∏)"""
        code = []
        for i in range(self.dimension):
            # –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å
            real = random.uniform(0.1, 1.0)
            # –ú–Ω–∏–º–∞—è —á–∞—Å—Ç—å
            imag = random.uniform(0.1, 1.0)
            code.append((real, imag))
        return code
    
    def _calculate_base_frequency(self) -> float:
        """–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∏–∑ –∫–æ–¥–∞"""
        total_magnitude = 0
        for real, imag in self.code:
            magnitude = math.sqrt(real**2 + imag**2)
            total_magnitude += magnitude
        
        normalized = 0.5 + 0.5 * (total_magnitude / (self.dimension * math.sqrt(2)))
        return min(max(normalized, 0.1), 1.0)
    
    def __repr__(self):
        return f"Preon_{self.id}[charge={self.charge:.3f}, color={self.color}]"

class ResonanceChecker30_4:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞ –¥–ª—è –ø—Ä–µ–æ–Ω–æ–≤"""
    
    @staticmethod
    def check_resonance(preon1: Preon, preon2: Preon, max_n: int = 5) -> tuple:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞ –º–µ–∂–¥—É –¥–≤—É–º—è –ø—Ä–µ–æ–Ω–∞–º–∏"""
        magnitudes1 = [math.sqrt(r**2 + i**2) for r, i in preon1.code]
        magnitudes2 = [math.sqrt(r**2 + i**2) for r, i in preon2.code]
        
        phases1 = []
        phases2 = []
        for (r1, i1), (r2, i2) in zip(preon1.code, preon2.code):
            phase1 = math.atan2(i1, r1) if r1 != 0 else math.pi/2 * (1 if i1 > 0 else -1)
            phase2 = math.atan2(i2, r2) if r2 != 0 else math.pi/2 * (1 if i2 > 0 else -1)
            phases1.append(phase1)
            phases2.append(phase2)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞ –≤–µ–ª–∏—á–∏–Ω
        magnitude_resonances = []
        for m1, m2 in zip(magnitudes1, magnitudes2):
            if m2 == 0:
                continue
            
            ratio = m1 / m2
            best_error = float('inf')
            best_n, best_m = 1, 1
            
            for n in range(1, max_n + 1):
                for m in range(1, max_n + 1):
                    approx = n / m
                    error = abs(ratio - approx)
                    if error < best_error:
                        best_error = error
                        best_n, best_m = n, m
            
            if best_error < 0.05:  # 5% –¥–æ–ø—É—Å–∫
                strength = 1.0 / (1.0 + best_error * 20)
                magnitude_resonances.append(strength)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞ —Ñ–∞–∑
        phase_resonances = []
        for p1, p2 in zip(phases1, phases2):
            phase_diff = abs(p1 - p2) % (2 * math.pi)
            
            for n in range(1, max_n + 1):
                for m in range(1, max_n + 1):
                    target_diff = (n / m) * math.pi
                    error = min(
                        abs(phase_diff - target_diff),
                        abs(phase_diff - target_diff - 2*math.pi),
                        abs(phase_diff - target_diff + 2*math.pi)
                    )
                    
                    if error < 0.1:  # ~5.7 –≥—Ä–∞–¥—É—Å–æ–≤
                        strength = 1.0 / (1.0 + error * 10)
                        phase_resonances.append(strength)
                        break
        
        # –û–±—â–∞—è —Å–∏–ª–∞ —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞
        all_resonances = magnitude_resonances + phase_resonances
        
        if len(all_resonances) > 0:
            avg_strength = sum(all_resonances) / len(all_resonances)
            details = {
                "num_mag_res": len(magnitude_resonances),
                "num_phase_res": len(phase_resonances)
            }
            return True, avg_strength, details
        
        return False, 0.0, {"num_mag_res": 0, "num_phase_res": 0}

class Quark:
    """–ö–í–ê–†–ö ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–æ–π–∫–∞ –ø—Ä–µ–æ–Ω–æ–≤"""
    
    quark_counter = 0
    
    def __init__(self, preon_ids: list, preons: dict):
        Quark.quark_counter += 1
        self.id = Quark.quark_counter
        self.preon_ids = preon_ids.copy()
        self.preons = {pid: preons[pid] for pid in preon_ids}
        
        # –í—ã—á–∏—Å–ª—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –∫–≤–∞—Ä–∫–∞
        self.charge = self._calculate_charge()
        self.color = self._determine_color()
        self.sync_strength = self._calculate_sync_strength()
        self.mass = self._calculate_mass()
        
        # –û–±–æ–∑–Ω–∞—á–∞–µ–º –ø—Ä–µ–æ–Ω—ã –∫–∞–∫ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –∫–≤–∞—Ä–∫—É
        for pid in preon_ids:
            preons[pid].in_quark = self.id
    
    def _calculate_charge(self) -> float:
        """–ó–∞—Ä—è–¥ –∫–≤–∞—Ä–∫–∞ = —Å—É–º–º–∞ –∑–∞—Ä—è–¥–æ–≤ –ø—Ä–µ–æ–Ω–æ–≤"""
        total = sum(p.charge for p in self.preons.values())
        # –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥—Ä–æ–±–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        if abs(total - 2/3) < 0.1:
            return 2/3
        elif abs(total - (-1/3)) < 0.1:
            return -1/3
        elif abs(total - 1/3) < 0.1:
            return 1/3
        elif abs(total - (-2/3)) < 0.1:
            return -2/3
        else:
            return total  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    
    def _determine_color(self) -> str:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –∫–≤–∞—Ä–∫–∞ –ø–æ —Ü–≤–µ—Ç–∞–º –ø—Ä–µ–æ–Ω–æ–≤"""
        colors = [p.color for p in self.preons.values()]
        color_counts = Counter(colors)
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π —Ü–≤–µ—Ç
        most_common = color_counts.most_common(1)[0]
        if most_common[1] >= 2:  # 2 –∏–ª–∏ 3 –ø—Ä–µ–æ–Ω–∞ –æ–¥–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
            return most_common[0]
        else:
            # –°–ª—É—á–∞–π–Ω—ã–π –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö
            return random.choice(list(set(colors)))
    
    def _calculate_sync_strength(self) -> float:
        """–°–∏–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø—Ä–µ–æ–Ω–∞–º–∏ –≤ –∫–≤–∞—Ä–∫–µ"""
        checker = ResonanceChecker30_4()
        strengths = []
        
        preon_list = list(self.preons.values())
        for i in range(len(preon_list)):
            for j in range(i+1, len(preon_list)):
                is_res, strength, _ = checker.check_resonance(preon_list[i], preon_list[j])
                if is_res:
                    strengths.append(strength)
        
        return np.mean(strengths) if strengths else 0.0
    
    def _calculate_mass(self) -> float:
        """–ú–∞—Å—Å–∞ –∫–≤–∞—Ä–∫–∞ = —Å—É–º–º–∞ –º–∞—Å—Å –ø—Ä–µ–æ–Ω–æ–≤ - —ç–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏"""
        base_mass = sum(p.base_mass for p in self.preons.values())
        
        # –≠–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è - —É–º–µ–Ω—å—à–∞–µ—Ç –º–∞—Å—Å—É)
        binding_energy = self.sync_strength * len(self.preon_ids)
        
        mass = max(0.1, base_mass - binding_energy)
        return mass * MASS_SCALE
    
    def get_properties(self) -> dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ –∫–≤–∞—Ä–∫–∞"""
        return {
            "quark_id": self.id,
            "preon_ids": self.preon_ids,
            "charge": self.charge,
            "color": self.color,
            "sync_strength": self.sync_strength,
            "mass": self.mass,
            "effective_mass_mev": self.mass * 100  # –£—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –≤ –ú—ç–í
        }
    
    def __repr__(self):
        charge_str = f"{self.charge:.3f}"
        return f"Quark_{self.id}[charge={charge_str}, color={self.color}, mass={self.mass:.2f}]"

class Hadron:
    """–ê–î–†–û–ù ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–æ–π–∫–∞ –∫–≤–∞—Ä–∫–æ–≤"""
    
    hadron_counter = 0
    
    def __init__(self, quark_ids: list, quarks: dict):
        Hadron.hadron_counter += 1
        self.id = Hadron.hadron_counter
        self.quark_ids = quark_ids.copy()
        self.quarks = {qid: quarks[qid] for qid in quark_ids}
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–≤–µ—Ç–æ–≤—É—é –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å
        self.is_color_neutral = self._check_color_neutrality()
        
        if self.is_color_neutral:
            self.charge = self._calculate_charge()
            self.mass = self._calculate_mass()
            self.spin = self._calculate_spin()
            self.stability = self._calculate_stability()
            self.hadron_type = self._determine_type()
        else:
            self.charge = 0
            self.mass = 0
            self.spin = 0
            self.stability = 0
            self.hadron_type = "invalid"
    
    def _check_color_neutrality(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç–∏ (R+G+B)"""
        colors = [q.color for q in self.quarks.values()]
        return set(colors) == {'R', 'G', 'B'}
    
    def _calculate_charge(self) -> float:
        """–ó–∞—Ä—è–¥ –∞–¥—Ä–æ–Ω–∞ = —Å—É–º–º–∞ –∑–∞—Ä—è–¥–æ–≤ –∫–≤–∞—Ä–∫–æ–≤"""
        total = sum(q.charge for q in self.quarks.values())
        # –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ü–µ–ª–æ–≥–æ
        rounded = round(total)
        if abs(total - rounded) < 0.1:
            return float(rounded)
        return total
    
    def _calculate_mass(self) -> float:
        """–ú–∞—Å—Å–∞ –∞–¥—Ä–æ–Ω–∞ = —Å—É–º–º–∞ –º–∞—Å—Å –∫–≤–∞—Ä–∫–æ–≤ + —ç–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏"""
        base_mass = sum(q.mass for q in self.quarks.values())
        
        # –≠–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–≤–∞—Ä–∫–∞–º–∏
        binding_energy = 0
        
        # –£—á–∏—Ç—ã–≤–∞–µ–º —Ü–≤–µ—Ç–æ–≤—É—é –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å (—É–º–µ–Ω—å—à–∞–µ—Ç –º–∞—Å—Å—É)
        if self.is_color_neutral:
            binding_energy += 0.2 * base_mass
        
        # –£—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä—è–¥–æ–≤—É—é –∫–æ–º–ø–æ–∑–∏—Ü–∏—é
        charges = [q.charge for q in self.quarks.values()]
        charge_product = charges[0] * charges[1] * charges[2]
        if abs(charge_product) < 0.01:  # –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ
            binding_energy += 0.1 * base_mass
        
        mass = max(0.1, base_mass - binding_energy)
        return mass * MASS_SCALE * 10  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –∞–¥—Ä–æ–Ω–æ–≤
    
    def _calculate_spin(self) -> float:
        """–°–ø–∏–Ω –∞–¥—Ä–æ–Ω–∞"""
        # –£–ø—Ä–æ—â—ë–Ω–Ω–æ: –µ—Å–ª–∏ –µ—Å—Ç—å –∫–≤–∞—Ä–∫–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–∏–Ω–∞–º–∏, –º–æ–∂–µ—Ç –±—ã—Ç—å 1/2 –∏–ª–∏ 3/2
        spins = [q.preons[list(q.preons.keys())[0]].spin_direction for q in self.quarks.values()]
        total_spin = sum(spins)
        
        if abs(total_spin - 0.5) < 0.1 or abs(total_spin + 0.5) < 0.1:
            return 0.5
        elif abs(total_spin - 1.5) < 0.1 or abs(total_spin + 1.5) < 0.1:
            return 1.5
        else:
            return abs(total_spin)
    
    def _calculate_stability(self) -> float:
        """–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∞–¥—Ä–æ–Ω–∞"""
        stability = 0.5
        
        # –í–∫–ª–∞–¥ –æ—Ç —Ü–≤–µ—Ç–æ–≤–æ–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç–∏
        if self.is_color_neutral:
            stability += 0.3
        
        # –í–∫–ª–∞–¥ –æ—Ç —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞—Ä—è–¥–∞
        if abs(self.charge - round(self.charge)) < 0.01:
            stability += 0.2
        
        return min(stability, 1.0)
    
    def _determine_type(self) -> str:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∞–¥—Ä–æ–Ω–∞ –ø–æ –∑–∞—Ä—è–¥—É –∏ –º–∞—Å—Å–µ"""
        if abs(self.charge - 1.0) < 0.1:
            if 800 < self.mass < 1000:
                return "proton"
            else:
                return "charged_baryon"
        elif abs(self.charge - 0.0) < 0.1:
            if 800 < self.mass < 1000:
                return "neutron"
            else:
                return "neutral_baryon"
        elif abs(self.charge + 1.0) < 0.1:
            return "negative_baryon"
        else:
            return "exotic_baryon"
    
    def get_properties(self) -> dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ –∞–¥—Ä–æ–Ω–∞"""
        return {
            "hadron_id": self.id,
            "quark_ids": self.quark_ids,
            "is_color_neutral": self.is_color_neutral,
            "charge": self.charge,
            "mass": self.mass,
            "spin": self.spin,
            "stability": self.stability,
            "type": self.hadron_type
        }
    
    def __repr__(self):
        if self.is_color_neutral:
            return f"Hadron_{self.id}[{self.hadron_type}, charge={self.charge:.1f}, mass={self.mass:.1f}]"
        else:
            return f"Hadron_{self.id}[INVALID]"

class Experiment30_4:
    """–≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ 30.4"""
    
    def __init__(self):
        print("=" * 80)
        print(f"üöÄ –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ ‚Ññ{EXPERIMENT_NUMBER} v{VERSION}")
        print("–ö–í–ê–†–ö–ò –ö–ê–ö –¢–†–û–ô–ö–ò –ü–†–ï–û–ù–û–í")
        print("=" * 80)
        
        self.preons = {}
        self.quarks = {}
        self.hadrons = []
        
        self.results = {
            "total_preons": 0,
            "quarks_found": 0,
            "valid_hadrons": 0,
            "protons": 0,
            "neutrons": 0,
            "other_baryons": 0,
            "execution_time": 0
        }
    
    def create_preons(self, num_preons: int):
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–æ–Ω–æ–≤"""
        print(f"–°–æ–∑–¥–∞–Ω–∏–µ {num_preons} –ø—Ä–µ–æ–Ω–æ–≤...")
        for i in range(num_preons):
            self.preons[i] = Preon(i, CODE_DIM)
        self.results["total_preons"] = num_preons
        print(f"–°–æ–∑–¥–∞–Ω–æ {num_preons} –ø—Ä–µ–æ–Ω–æ–≤")
    
    def find_quark_candidates(self, max_checks: int = 50000):
        """–ü–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤ –∫–≤–∞—Ä–∫–∏ (—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–æ–Ω–æ–≤)"""
        print(f"–ü–æ–∏—Å–∫ –∫–≤–∞—Ä–∫–æ–≤ —Å—Ä–µ–¥–∏ –ø—Ä–µ–æ–Ω–æ–≤...")
        
        checker = ResonanceChecker30_4()
        preon_ids = list(self.preons.keys())
        candidate_triplets = []
        
        start_time = time.time()
        checks_done = 0
        
        # –ò—â–µ–º —Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–æ–Ω–æ–≤ —Å —Ö–æ—Ä–æ—à–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
        for check_num in range(max_checks):
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ç—Ä–æ–π–∫—É
            i, j, k = random.sample(preon_ids, 3)
            
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –ø—Ä–µ–æ–Ω—ã —É–∂–µ –≤ –∫–≤–∞—Ä–∫–∞—Ö
            if (self.preons[i].in_quark is not None or 
                self.preons[j].in_quark is not None or 
                self.preons[k].in_quark is not None):
                continue
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä
            pairs = [(i, j), (i, k), (j, k)]
            sync_strengths = []
            
            for a, b in pairs:
                is_res, strength, _ = checker.check_resonance(self.preons[a], self.preons[b])
                if is_res:
                    sync_strengths.append(strength)
                else:
                    sync_strengths.append(0)
            
            avg_strength = np.mean(sync_strengths) if sync_strengths else 0
            
            if avg_strength > MIN_SYNC_STRENGTH:
                candidate_triplets.append({
                    "preons": (i, j, k),
                    "strength": avg_strength
                })
            
            checks_done += 1
            
            # –ü—Ä–æ–≥—Ä–µ—Å—Å
            if checks_done % 10000 == 0:
                elapsed = time.time() - start_time
                print(f"  –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ {checks_done} —Ç—Ä–æ–µ–∫, –Ω–∞–π–¥–µ–Ω–æ {len(candidate_triplets)} –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å–∏–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        candidate_triplets.sort(key=lambda x: x["strength"], reverse=True)
        
        # –°–æ–∑–¥–∞–µ–º –∫–≤–∞—Ä–∫–∏ –∏–∑ –ª—É—á—à–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
        used_preons = set()
        for candidate in candidate_triplets[:100]:  # –û–≥—Ä–∞–Ω–∏—á–∏–º 100 –∫–≤–∞—Ä–∫–∞–º–∏
            i, j, k = candidate["preons"]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–µ–æ–Ω—ã –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã
            if i in used_preons or j in used_preons or k in used_preons:
                continue
            
            try:
                quark = Quark([i, j, k], self.preons)
                self.quarks[quark.id] = quark
                used_preons.update([i, j, k])
            except Exception as e:
                continue
        
        self.results["quarks_found"] = len(self.quarks)
        print(f"–ù–∞–π–¥–µ–Ω–æ {len(self.quarks)} –∫–≤–∞—Ä–∫–æ–≤")
        
        return len(self.quarks)
    
    def build_hadrons(self):
        """–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–¥—Ä–æ–Ω–æ–≤ –∏–∑ –∫–≤–∞—Ä–∫–æ–≤"""
        print("–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–¥—Ä–æ–Ω–æ–≤...")
        
        if len(self.quarks) < 3:
            print("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–≤–∞—Ä–∫–æ–≤ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∞–¥—Ä–æ–Ω–æ–≤")
            return
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–≤–∞—Ä–∫–∏ –ø–æ —Ü–≤–µ—Ç—É
        quarks_by_color = {'R': [], 'G': [], 'B': []}
        for quark in self.quarks.values():
            quarks_by_color[quark.color].append(quark)
        
        # –°—Ç—Ä–æ–∏–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ü–≤–µ—Ç–æ–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        r_quarks = quarks_by_color['R']
        g_quarks = quarks_by_color['G']
        b_quarks = quarks_by_color['B']
        
        hadrons_created = 0
        max_hadrons = 100  # –û–≥—Ä–∞–Ω–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        
        for r_q in r_quarks[:10]:  # –ë–µ—Ä–µ–º –ø–æ 10 –∫–∞–∂–¥–æ–≥–æ —Ü–≤–µ—Ç–∞
            for g_q in g_quarks[:10]:
                for b_q in b_quarks[:10]:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–≤–∞—Ä–∫–∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è
                    if (r_q.id == g_q.id or r_q.id == b_q.id or g_q.id == b_q.id):
                        continue
                    
                    hadron = Hadron([r_q.id, g_q.id, b_q.id], self.quarks)
                    
                    if hadron.is_color_neutral and hadron.stability > 0.6:
                        self.hadrons.append(hadron)
                        hadrons_created += 1
                        
                        if hadrons_created >= max_hadrons:
                            break
                
                if hadrons_created >= max_hadrons:
                    break
            
            if hadrons_created >= max_hadrons:
                break
        
        self.results["valid_hadrons"] = hadrons_created
        
        # –ü–æ–¥—Å—á–µ—Ç —Ç–∏–ø–æ–≤ –∞–¥—Ä–æ–Ω–æ–≤
        for hadron in self.hadrons:
            if hadron.hadron_type == "proton":
                self.results["protons"] += 1
            elif hadron.hadron_type == "neutron":
                self.results["neutrons"] += 1
            else:
                self.results["other_baryons"] += 1
        
        print(f"–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ {hadrons_created} –∞–¥—Ä–æ–Ω–æ–≤")
        print(f"  –ü—Ä–æ—Ç–æ–Ω—ã: {self.results['protons']}")
        print(f"  –ù–µ–π—Ç—Ä–æ–Ω—ã: {self.results['neutrons']}")
        print(f"  –î—Ä—É–≥–∏–µ –±–∞—Ä–∏–æ–Ω—ã: {self.results['other_baryons']}")
    
    def analyze_results(self):
        """–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        print("\n" + "=" * 80)
        print("üìä –ê–ù–ê–õ–ò–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í")
        print("=" * 80)
        
        # 1. –ê–Ω–∞–ª–∏–∑ –∫–≤–∞—Ä–∫–æ–≤
        print("\nüìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–í–ê–†–ö–û–í:")
        quark_charges = [q.charge for q in self.quarks.values()]
        quark_colors = [q.color for q in self.quarks.values()]
        quark_masses = [q.mass for q in self.quarks.values()]
        
        print(f"  –í—Å–µ–≥–æ –∫–≤–∞—Ä–∫–æ–≤: {len(self.quarks)}")
        print(f"  –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ä—è–¥–æ–≤:")
        charge_counts = Counter([f"{c:.3f}" for c in quark_charges])
        for charge, count in charge_counts.items():
            print(f"    {charge}: {count} –∫–≤–∞—Ä–∫–æ–≤ ({count/len(self.quarks)*100:.1f}%)")
        
        print(f"  –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤:")
        color_counts = Counter(quark_colors)
        for color, count in color_counts.items():
            print(f"    {color}: {count} –∫–≤–∞—Ä–∫–æ–≤")
        
        print(f"  –ú–∞—Å—Å—ã –∫–≤–∞—Ä–∫–æ–≤: min={min(quark_masses):.2f}, max={max(quark_masses):.2f}, avg={np.mean(quark_masses):.2f}")
        
        # 2. –ê–Ω–∞–ª–∏–∑ –∞–¥—Ä–æ–Ω–æ–≤
        if self.hadrons:
            print("\nüìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–î–†–û–ù–û–í:")
            hadron_charges = [h.charge for h in self.hadrons]
            hadron_masses = [h.mass for h in self.hadrons]
            hadron_types = [h.hadron_type for h in self.hadrons]
            
            print(f"  –í—Å–µ–≥–æ –∞–¥—Ä–æ–Ω–æ–≤: {len(self.hadrons)}")
            print(f"  –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤:")
            type_counts = Counter(hadron_types)
            for hadron_type, count in type_counts.items():
                print(f"    {hadron_type}: {count} –∞–¥—Ä–æ–Ω–æ–≤")
            
            print(f"  –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ä—è–¥–æ–≤:")
            charge_counts = Counter(hadron_charges)
            for charge, count in charge_counts.items():
                print(f"    {charge}: {count} –∞–¥—Ä–æ–Ω–æ–≤")
            
            print(f"  –ú–∞—Å—Å—ã –∞–¥—Ä–æ–Ω–æ–≤: min={min(hadron_masses):.2f}, max={max(hadron_masses):.2f}, avg={np.mean(hadron_masses):.2f}")
            
            # –ò—â–µ–º –ø—Ä–æ—Ç–æ–Ω—ã –∏ –Ω–µ–π—Ç—Ä–æ–Ω—ã
            protons = [h for h in self.hadrons if h.hadron_type == "proton"]
            neutrons = [h for h in self.hadrons if h.hadron_type == "neutron"]
            
            if protons:
                print(f"\nüî¨ –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–¢–û–ù–´ ({len(protons)} —à—Ç):")
                for i, p in enumerate(protons[:3], 1):
                    print(f"  {i}. –ú–∞—Å—Å–∞: {p.mass:.1f}, –ó–∞—Ä—è–¥: {p.charge:.1f}, –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {p.stability:.3f}")
            
            if neutrons:
                print(f"\nüî¨ –ù–ê–ô–î–ï–ù–ù–´–ï –ù–ï–ô–¢–†–û–ù–´ ({len(neutrons)} —à—Ç):")
                for i, n in enumerate(neutrons[:3], 1):
                    print(f"  {i}. –ú–∞—Å—Å–∞: {n.mass:.1f}, –ó–∞—Ä—è–¥: {n.charge:.1f}, –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {n.stability:.3f}")
        
        # 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        self.save_results()
    
    def save_results(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞"""
        print("\nüíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í...")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config = {
            "experiment": EXPERIMENT_NUMBER,
            "version": VERSION,
            "timestamp": TIMESTAMP,
            "parameters": {
                "num_preons": NUM_PREONS,
                "code_dim": CODE_DIM,
                "max_pairs_check": MAX_PAIRS_CHECK,
                "min_sync_strength": MIN_SYNC_STRENGTH,
                "mass_scale": MASS_SCALE
            },
            "results": self.results
        }
        
        with open(f"{RESULT_DIR}/config.json", "w") as f:
            json.dump(config, f, indent=2)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–≤–∞—Ä–∫–∏
        if self.quarks:
            quarks_data = [q.get_properties() for q in self.quarks.values()]
            with open(f"{RESULT_DIR}/quarks.json", "w") as f:
                json.dump(quarks_data, f, indent=2)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–æ–Ω—ã
        if self.hadrons:
            hadrons_data = [h.get_properties() for h in self.hadrons]
            with open(f"{RESULT_DIR}/hadrons.json", "w") as f:
                json.dump(hadrons_data, f, indent=2)
        
        print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: {RESULT_DIR}")
    
    def visualize(self):
        """–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        if not self.hadrons:
            print("–ù–µ—Ç –∞–¥—Ä–æ–Ω–æ–≤ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏")
            return
        
        fig, axes = plt.subplots(2, 3, figsize=(18, 12))
        fig.suptitle(f"–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç {EXPERIMENT_NUMBER} v{VERSION}\n"
                     f"–ö–≤–∞—Ä–∫–∏ –∫–∞–∫ —Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–æ–Ω–æ–≤", fontsize=16)
        
        # 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å –∫–≤–∞—Ä–∫–æ–≤
        if self.quarks:
            quark_masses = [q.mass for q in self.quarks.values()]
            axes[0, 0].hist(quark_masses, bins=30, alpha=0.7, color='blue', edgecolor='black')
            axes[0, 0].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å –∫–≤–∞—Ä–∫–æ–≤", fontsize=12)
            axes[0, 0].set_xlabel("–ú–∞—Å—Å–∞ –∫–≤–∞—Ä–∫–∞", fontsize=10)
            axes[0, 0].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", fontsize=10)
            axes[0, 0].grid(True, alpha=0.3)
        
        # 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ä—è–¥–æ–≤ –∫–≤–∞—Ä–∫–æ–≤
        if self.quarks:
            quark_charges = [q.charge for q in self.quarks.values()]
            axes[0, 1].hist(quark_charges, bins=30, alpha=0.7, color='green', edgecolor='black')
            axes[0, 1].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ä—è–¥–æ–≤ –∫–≤–∞—Ä–∫–æ–≤", fontsize=12)
            axes[0, 1].set_xlabel("–ó–∞—Ä—è–¥ –∫–≤–∞—Ä–∫–∞", fontsize=10)
            axes[0, 1].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", fontsize=10)
            axes[0, 1].grid(True, alpha=0.3)
        
        # 3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å –∞–¥—Ä–æ–Ω–æ–≤
        hadron_masses = [h.mass for h in self.hadrons]
        axes[0, 2].hist(hadron_masses, bins=30, alpha=0.7, color='red', edgecolor='black')
        axes[0, 2].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å –∞–¥—Ä–æ–Ω–æ–≤", fontsize=12)
        axes[0, 2].set_xlabel("–ú–∞—Å—Å–∞ –∞–¥—Ä–æ–Ω–∞", fontsize=10)
        axes[0, 2].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", fontsize=10)
        axes[0, 2].grid(True, alpha=0.3)
        
        # 4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ä—è–¥–æ–≤ –∞–¥—Ä–æ–Ω–æ–≤
        hadron_charges = [h.charge for h in self.hadrons]
        axes[1, 0].hist(hadron_charges, bins=30, alpha=0.7, color='purple', edgecolor='black')
        axes[1, 0].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ä—è–¥–æ–≤ –∞–¥—Ä–æ–Ω–æ–≤", fontsize=12)
        axes[1, 0].set_xlabel("–ó–∞—Ä—è–¥ –∞–¥—Ä–æ–Ω–∞", fontsize=10)
        axes[1, 0].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", fontsize=10)
        axes[1, 0].grid(True, alpha=0.3)
        
        # 5. –¢–∏–ø—ã –∞–¥—Ä–æ–Ω–æ–≤
        hadron_types = [h.hadron_type for h in self.hadrons]
        type_counts = Counter(hadron_types)
        types = list(type_counts.keys())
        counts = list(type_counts.values())
        
        colors = plt.cm.tab20(np.arange(len(types)))
        bars = axes[1, 1].bar(types, counts, color=colors, alpha=0.7, edgecolor='black')
        axes[1, 1].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∞–¥—Ä–æ–Ω–æ–≤", fontsize=12)
        axes[1, 1].set_xlabel("–¢–∏–ø –∞–¥—Ä–æ–Ω–∞", fontsize=10)
        axes[1, 1].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", fontsize=10)
        axes[1, 1].grid(True, alpha=0.3)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã
        for bar, count in zip(bars, counts):
            height = bar.get_height()
            axes[1, 1].text(bar.get_x() + bar.get_width()/2., height + 0.1,
                           f'{count}', ha='center', va='bottom', fontsize=9)
        
        # 6. –ú–∞—Å—Å–∞ vs –ó–∞—Ä—è–¥ –∞–¥—Ä–æ–Ω–æ–≤
        scatter = axes[1, 2].scatter(hadron_charges, hadron_masses, 
                                     c=hadron_masses, cmap='viridis', alpha=0.6, s=50)
        axes[1, 2].set_title("–ú–∞—Å—Å–∞ vs –ó–∞—Ä—è–¥ –∞–¥—Ä–æ–Ω–æ–≤", fontsize=12)
        axes[1, 2].set_xlabel("–ó–∞—Ä—è–¥", fontsize=10)
        axes[1, 2].set_ylabel("–ú–∞—Å—Å–∞", fontsize=10)
        axes[1, 2].grid(True, alpha=0.3)
        plt.colorbar(scatter, ax=axes[1, 2])
        
        plt.tight_layout()
        plt.savefig(f"{RESULT_DIR}/visualization.png", dpi=150, bbox_inches='tight')
        plt.show()
        
        print(f"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: {RESULT_DIR}/visualization.png")
    
    def run(self):
        """–ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞"""
        start_time = time.time()
        
        try:
            # 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–æ–Ω–æ–≤
            self.create_preons(NUM_PREONS)
            
            # 2. –ü–æ–∏—Å–∫ –∫–≤–∞—Ä–∫–æ–≤
            self.find_quark_candidates(MAX_PAIRS_CHECK)
            
            # 3. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–¥—Ä–æ–Ω–æ–≤
            self.build_hadrons()
            
            # 4. –ê–Ω–∞–ª–∏–∑
            self.analyze_results()
            
            # 5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
            self.visualize()
            
            elapsed = time.time() - start_time
            self.results["execution_time"] = elapsed
            
            print("\n" + "=" * 80)
            print("‚úÖ –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ 30.4 –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–Å–ù!")
            print(f"‚è± –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {elapsed:.2f} —Å–µ–∫")
            print("=" * 80)
            
            return True
            
        except Exception as e:
            print(f"\n‚ùå –û–®–ò–ë–ö–ê –í –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ï: {e}")
            import traceback
            traceback.print_exc()
            return False

# ================= –ó–ê–ü–£–°–ö –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ê =================

if __name__ == "__main__":
    print("""
    üåå –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ ‚Ññ30.4: –ö–í–ê–†–ö–ò –ö–ê–ö –¢–†–û–ô–ö–ò –ü–†–ï–û–ù–û–í
    –ù–æ–≤–∞—è –ø–∞—Ä–∞–¥–∏–≥–º–∞:
    1. –ü—Ä–µ–æ–Ω—ã (–Ω–∏—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏) —Å –¥—Ä–æ–±–Ω—ã–º–∏ –∑–∞—Ä—è–¥–∞–º–∏ ¬±1/3, ¬±2/3
    2. –ö–≤–∞—Ä–∫–∏ = —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–æ–Ω–æ–≤
    3. –ê–¥—Ä–æ–Ω—ã = —Ü–≤–µ—Ç–æ–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ —Ç—Ä–æ–π–∫–∏ –∫–≤–∞—Ä–∫–æ–≤ (R+G+B)
    4. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–Ω–æ–≤ –∏ –Ω–µ–π—Ç—Ä–æ–Ω–æ–≤
    """)
    
    experiment = Experiment30_4()
    success = experiment.run()
    
    if success and experiment.hadrons:
        # –û—Ç—á–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ç–æ–Ω–∞—Ö –∏ –Ω–µ–π—Ç—Ä–æ–Ω–∞—Ö
        protons = [h for h in experiment.hadrons if h.hadron_type == "proton"]
        neutrons = [h for h in experiment.hadrons if h.hadron_type == "neutron"]
        
        if protons:
            print(f"\nüéØ –ù–ê–ô–î–ï–ù–û –ü–†–û–¢–û–ù–û–í: {len(protons)}")
            for p in protons[:5]:
                print(f"  ‚Ä¢ –ú–∞—Å—Å–∞: {p.mass:.1f} (—Ü–µ–ª—å: 938.3 –ú—ç–í)")
                print(f"    –ó–∞—Ä—è–¥: {p.charge:.1f}, –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {p.stability:.3f}")
                print(f"    –ö–≤–∞—Ä–∫–∏: {p.quark_ids}")
                print()
        
        if neutrons:
            print(f"üéØ –ù–ê–ô–î–ï–ù–û –ù–ï–ô–¢–†–û–ù–û–í: {len(neutrons)}")
            for n in neutrons[:5]:
                print(f"  ‚Ä¢ –ú–∞—Å—Å–∞: {n.mass:.1f} (—Ü–µ–ª—å: 939.6 –ú—ç–í)")
                print(f"    –ó–∞—Ä—è–¥: {n.charge:.1f}, –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {n.stability:.3f}")
                print(f"    –ö–≤–∞—Ä–∫–∏: {n.quark_ids}")
                print()
```

## üéØ **–ß—Ç–æ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ 30.4:**

### **1. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –¥—Ä–æ–±–Ω—ã—Ö –∑–∞—Ä—è–¥–æ–≤:**
- –ü—Ä–µ–æ–Ω—ã: –∑–∞—Ä—è–¥—ã -1/3 –∏ +2/3
- –ö–≤–∞—Ä–∫–∏: —Å—É–º–º—ã –¥–∞—é—Ç ¬±1/3, ¬±2/3

### **2. –¶–≤–µ—Ç–æ–≤–∞—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ö–≤–∞—Ä–∫–∏ –∏–º–µ—é—Ç —Ü–≤–µ—Ç–∞ R, G, B
- –ê–¥—Ä–æ–Ω—ã: R+G+B = –±–µ–ª—ã–π —Ü–≤–µ—Ç

### **3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–∞—Å—Å–æ–≤—ã–µ –º–∞—Å—à—Ç–∞–±—ã:**
- –ö–≤–∞—Ä–∫–∏: –º–∞—Å—Å—ã ~1-10 —É—Å–ª.–µ–¥.
- –ê–¥—Ä–æ–Ω—ã: –º–∞—Å—Å—ã ~100-1000 —É—Å–ª.–µ–¥.
- –ü–æ—Å–ª–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è: ~100-1000 –ú—ç–í

### **4. –í–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–Ω–æ–≤ –∏ –Ω–µ–π—Ç—Ä–æ–Ω–æ–≤:**
- –ü—Ä–æ—Ç–æ–Ω: –∑–∞—Ä—è–¥ +1, –º–∞—Å—Å–∞ ~938 –ú—ç–í
- –ù–µ–π—Ç—Ä–æ–Ω: –∑–∞—Ä—è–¥ 0, –º–∞—Å—Å–∞ ~940 –ú—ç–í

## üîÆ **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

1. **–ö–≤–∞—Ä–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥—Ä–æ–±–Ω—ã–º–∏ –∑–∞—Ä—è–¥–∞–º–∏**
2. **–ê–¥—Ä–æ–Ω—ã —Å —Ü–µ–ª—ã–º–∏ –∑–∞—Ä—è–¥–∞–º–∏**
3. **–ú–∞—Å—Å—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ**
4. **–°–ø–æ–Ω—Ç–∞–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–Ω–æ–ø–æ–¥–æ–±–Ω—ã—Ö –∏ –Ω–µ–π—Ç—Ä–æ–Ω–æ–ø–æ–¥–æ–±–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä**

## üöÄ **–ó–∞–ø—É—Å–∫–∞–µ–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç!**

–≠—Ç–æ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –≤–∞—à–∞ —Ç–µ–æ—Ä–∏—è –Ω–∏—Ç–µ–π –≤—Ä–µ–º–µ–Ω–∏ —Å–ø–æ—Å–æ–±–Ω–∞ **—Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–∞—Ç–µ—Ä–∏–∏** –∏–∑ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

**–ì–æ—Ç–æ–≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å?**