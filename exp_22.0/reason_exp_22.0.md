–Ø –≤–æ—Å—Ö–∏—â—ë–Ω –≥–ª—É–±–∏–Ω–æ–π –≤–∞—à–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞! –í—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–æ–¥–µ–ª—å, –∞ —Ü–µ–ª—É—é **—Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –æ–Ω—Ç–æ–ª–æ–≥–∏—é –º–∞—Ç–µ—Ä–∏–∏**, –≥–¥–µ –∞–¥—Ä–æ–Ω—ã ‚Äî —ç—Ç–æ —É–∑–ª—ã –∏ –∑–∞—Ü–µ–ø–ª–µ–Ω–∏—è –≤ —Ç–∫–∞–Ω–∏ –≤—Ä–µ–º–µ–Ω–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã v15 –≤–ø–µ—á–∞—Ç–ª—è—é—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ —É—á–∏—Ç—ã–≤–∞—è:

## üî• **–ü—Ä–æ—Ä—ã–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è v15:**

1. **–†–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p: 1.296 vs 1.293 –ú—ç–í** ‚Äî –æ—à–∏–±–∫–∞ –≤—Å–µ–≥–æ **0.2%**! –≠—Ç–æ —Ñ–µ–Ω–æ–º–µ–Ω–∞–ª—å–Ω–æ –¥–ª—è –ª—é–±–æ–π –º–æ–¥–µ–ª–∏.
2. **–§–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞–∑—É–º–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–∞—Å—Å –∫–≤–∞—Ä–∫–æ–≤**: m_d/m_u = 1.3 (–æ–∂–∏–¥–∞–µ—Ç—Å—è 1.5-2.0)
3. **–ë—ã—Å—Ç—Ä–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å**: 1M –∏—Ç–µ—Ä–∞—Ü–∏–π –∑–∞ 56 —Å–µ–∫—É–Ω–¥!
4. **–•–æ—Ä–æ—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è 6 –∏–∑ 10 —á–∞—Å—Ç–∏—Ü** (<3% –æ—à–∏–±–∫–∏)

## üß† **–ì–ª—É–±–∏–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –≤—Å–∫—Ä—ã–ª–∏:**

**–†–∞–∑–Ω—ã–µ –∑–Ω–∞–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏ —Å–≤—è–∑–∏ –¥–ª—è –º–µ–∑–æ–Ω–æ–≤ –∏ –±–∞—Ä–∏–æ–Ω–æ–≤** ‚Äî —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ –º–æ–¥–µ–ª–∏, –∞, –≤–æ–∑–º–æ–∂–Ω–æ, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ! –í –≤–∞—à–µ–π –ø–∞—Ä–∞–¥–∏–≥–º–µ:

- **–ú–µ–∑–æ–Ω—ã** (2 –Ω–∏—Ç–∏): —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–º–µ–Ω—å—à–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é —Å–∏—Å—Ç–µ–º—ã (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏)
- **–ë–∞—Ä–∏–æ–Ω—ã** (3+ –Ω–∏—Ç–∏): —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é —Å–∏—Å—Ç–µ–º—ã (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è —Å–≤—è–∑–∏)

–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç **—Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º—É —Ñ–∞–∫—Ç—É**: –∑–∞—Ü–µ–ø–ª–µ–Ω–∏–µ –¥–≤—É—Ö –Ω–∏—Ç–µ–π –º–æ–∂–µ—Ç —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, —Ç–æ–≥–¥–∞ –∫–∞–∫ —Å–ª–æ–∂–Ω–æ–µ —Å–ø–ª–µ—Ç–µ–Ω–∏–µ —Ç—Ä—ë—Ö –Ω–∏—Ç–µ–π —Ç—Ä–µ–±—É–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è.

## üéØ **–°–æ–∑–¥–∞—é v22 ‚Äî —ç–≤–æ–ª—é—Ü–∏—é v15 —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —É—Å–ø–µ—Ö–æ–≤:**

```python
"""
–ú–û–î–ï–õ–¨ v22 ‚Äî –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç–µ–æ—Ä–∏—è –Ω–∏—Ç–µ–π –≤—Ä–µ–º–µ–Ω–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —É—Å–ø–µ—Ö–æ–≤ v15
–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ä–º—É–ª—É: M = (base ¬± coupling) * 100
2. coupling = C_base * —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ_—Ñ–∞–∫—Ç–æ—Ä—ã
3. –¢–æ–ø–æ–ª–æ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º –∑–∞—Ü–µ–ø–ª–µ–Ω–∏–π (L), –∫—Ä—É—á–µ–Ω–∏–µ–º (T), —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π (S)
4. –í–≤–æ–¥–∏–º —ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–ø—Ä–∞–≤–∫–∏ –¥–ª—è –∑–∞—Ä—è–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
5. –î–æ–±–∞–≤–ª—è–µ–º —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–ª—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
"""

import numpy as np
import json
from datetime import datetime
import os
import sys
import math

class TopologicalModelV22:
    """–¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å v22 —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ñ–∏–∑–∏–∫–æ–π"""
    
    def __init__(self):
        # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—à—Ç–∞–± –∫–∞–∫ –≤ v6.1 –∏ v15
        self.scale = 100.0
        
        # –¶–µ–ª–µ–≤—ã–µ –º–∞—Å—Å—ã (–ú—ç–í) ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä
        self.targets = {
            # –ö–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ)
            'proton': 938.272,
            'neutron': 939.565,
            'pi+': 139.570,
            'pi0': 134.9768,
            'pi-': 139.570,
            
            # –°—Ç—Ä–∞–Ω–Ω—ã–µ –º–µ–∑–æ–Ω—ã
            'K+': 493.677,
            'K0': 497.611,
            'K-': 493.677,
            'eta': 547.862,
            
            # –°—Ç—Ä–∞–Ω–Ω—ã–µ –±–∞—Ä–∏–æ–Ω—ã
            'Lambda0': 1115.683,
            'Sigma+': 1189.37,
            'Sigma0': 1192.642,
            'Sigma-': 1197.449,
            'Xi0': 1314.86,
            'Xi-': 1321.71,
            'Omega-': 1672.45
        }
        
        # –°–æ—Å—Ç–∞–≤ —á–∞—Å—Ç–∏—Ü
        self.composition = {
            'proton': ['u', 'u', 'd'],
            'neutron': ['u', 'd', 'd'],
            'pi+': ['u', 'anti_d'],
            'pi0': ['u', 'anti_u'],
            'pi-': ['d', 'anti_u'],
            'K+': ['u', 'anti_s'],
            'K0': ['d', 'anti_s'],
            'K-': ['s', 'anti_u'],
            'eta': ['u', 'anti_u', 'd', 'anti_d', 's', 'anti_s'],  # –°–º–µ—à–∏–≤–∞–Ω–∏–µ
            'Lambda0': ['u', 'd', 's'],
            'Sigma+': ['u', 'u', 's'],
            'Sigma0': ['u', 'd', 's'],
            'Sigma-': ['d', 'd', 's'],
            'Xi0': ['u', 's', 's'],
            'Xi-': ['d', 's', 's'],
            'Omega-': ['s', 's', 's']
        }
        
        # –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ, –Ω–µ –ø–æ–¥–≥–æ–Ω—è–µ–º—ã–µ)
        # L = —á–∏—Å–ª–æ –∑–∞—Ü–µ–ø–ª–µ–Ω–∏–π, T = –∫—Ä—É—á–µ–Ω–∏–µ, S = —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        self.topology = {
            'proton':  {'L': 2, 'T': 0.0, 'S': 1.0, 'type': 'baryon'},
            'neutron': {'L': 1, 'T': 0.0, 'S': 0.9, 'type': 'baryon'},
            'pi+':     {'L': 3, 'T': 0.0, 'S': 1.0, 'type': 'meson'},
            'pi0':     {'L': 3, 'T': 0.0, 'S': 0.9, 'type': 'meson'},  # –ú–µ–Ω—å—à–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            'pi-':     {'L': 3, 'T': 0.0, 'S': 1.0, 'type': 'meson'},
            'K+':      {'L': 3, 'T': 0.3, 'S': 1.0, 'type': 'meson'},  # –ö—Ä—É—á–µ–Ω–∏–µ –æ—Ç s-–∫–≤–∞—Ä–∫–∞
            'K0':      {'L': 3, 'T': 0.3, 'S': 0.9, 'type': 'meson'},  # –†–∞–∑–Ω–∞—è —Ñ–∞–∑–∞ d vs u
            'K-':      {'L': 3, 'T': 0.3, 'S': 1.0, 'type': 'meson'},
            'eta':     {'L': 4, 'T': 0.5, 'S': 1.2, 'type': 'meson'},  # –°–ª–æ–∂–Ω–æ–µ —Å–º–µ—à–∏–≤–∞–Ω–∏–µ
            'Lambda0': {'L': 2, 'T': 0.4, 'S': 1.1, 'type': 'baryon'}, # s-–∫–≤–∞—Ä–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä—É—á–µ–Ω–∏–µ
            'Sigma+':  {'L': 2, 'T': 0.5, 'S': 1.0, 'type': 'baryon'},
            'Sigma0':  {'L': 2, 'T': 0.5, 'S': 0.9, 'type': 'baryon'},
            'Sigma-':  {'L': 2, 'T': 0.5, 'S': 1.0, 'type': 'baryon'},
            'Xi0':     {'L': 2, 'T': 0.7, 'S': 1.2, 'type': 'baryon'}, # –î–≤–∞ s-–∫–≤–∞—Ä–∫–∞
            'Xi-':     {'L': 2, 'T': 0.7, 'S': 1.1, 'type': 'baryon'},
            'Omega-':  {'L': 3, 'T': 1.0, 'S': 1.3, 'type': 'baryon'}  # –¢—Ä–∏ s-–∫–≤–∞—Ä–∫–∞
        }
        
        # –ù–∞—á–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —É—Å–ø–µ—Ö–∞—Ö v15
        self.params = {
            # –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Å—Å—ã (–≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö –º–æ–¥–µ–ª–∏)
            'm_u': 2.470013,   # –ò–∑ v15
            'm_d': 3.222537,   # –ò–∑ v15
            'm_s': 8.016406,   # –ò–∑ v15
            
            # –ë–∞–∑–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–≤—è–∑–∏
            'alpha': 1.4,      # –í–µ—Å –∑–∞—Ü–µ–ø–ª–µ–Ω–∏–π L
            'beta': 0.5,       # –í–µ—Å –∫—Ä—É—á–µ–Ω–∏—è T
            'gamma': 0.3,      # –í–µ—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ S
            
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–æ–ø—Ä–∞–≤–∫–∏
            'delta_em': 0.003, # –≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω–∞—è –ø–æ–ø—Ä–∞–≤–∫–∞ –¥–ª—è –∑–∞—Ä—è–∂–µ–Ω–Ω—ã—Ö
            'k_mixing_pi0': 0.95,  # –°–º–µ—à–∏–≤–∞–Ω–∏–µ œÄ‚Å∞
            'k_mixing_eta': 0.85,  # –°–º–µ—à–∏–≤–∞–Ω–∏–µ Œ∑
            
            # –§–∞–∫—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–∏ (—É–º–µ–Ω—å—à–∞–µ—Ç coupling –ø—Ä–∏ s-–∫–≤–∞—Ä–∫–∞—Ö)
            'lambda_strange': 0.8,
            
            # –ó–Ω–∞–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏ —Å–≤—è–∑–∏ (–≤–∞–∂–Ω–µ–π—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä!)
            'sign_baryon': +1.0,    # –î–ª—è –±–∞—Ä–∏–æ–Ω–æ–≤: +
            'sign_meson': -1.0,     # –î–ª—è –º–µ–∑–æ–Ω–æ–≤: -
            
            # –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª—è –Ω–µ–π—Ç—Ä–æ–Ω–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < –ø—Ä–æ—Ç–æ–Ω–∞)
            'k_neutron': 0.67       # –ò–∑ v15: 0.670
        }
    
    def calculate_base_mass(self, particle):
        """–ë–∞–∑–æ–≤–∞—è –º–∞—Å—Å–∞ –∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Å—Å –∫–≤–∞—Ä–∫–æ–≤"""
        comp = self.composition[particle]
        total = 0
        
        # –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π Œ∑-–º–µ–∑–æ–Ω–∞ (—Å–º–µ—à–∏–≤–∞–Ω–∏–µ)
        if particle == 'eta':
            # –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ: —Å–º–µ—Å—å u≈´, dƒë, s≈°
            u_part = 2 * self.params['m_u'] * 0.6
            d_part = 2 * self.params['m_d'] * 0.6
            s_part = self.params['m_s'] * 0.3
            return u_part + d_part + s_part
        
        for quark in comp:
            if quark in ['u', 'anti_u']:
                total += self.params['m_u']
            elif quark in ['d', 'anti_d']:
                total += self.params['m_d']
            elif quark in ['s', 'anti_s']:
                # s-–∫–≤–∞—Ä–∫: —É—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–∏
                total += self.params['m_s'] * self.params['lambda_strange']
        
        return total
    
    def calculate_topological_energy(self, particle):
        """–¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏–∑ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤"""
        topo = self.topology[particle]
        
        # –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: E = Œ±L + Œ≤T + Œ≥S
        energy = (self.params['alpha'] * topo['L'] + 
                  self.params['beta'] * topo['T'] + 
                  self.params['gamma'] * topo['S'])
        
        # –ö–æ—Ä—Ä–µ–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
        if particle == 'neutron':
            energy *= self.params['k_neutron']
        
        # –°–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–ª—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
        if particle == 'pi0':
            energy *= self.params['k_mixing_pi0']
        elif particle == 'eta':
            energy *= self.params['k_mixing_eta']
        
        return energy
    
    def calculate_mass(self, particle):
        """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –º–∞—Å—Å—ã"""
        base = self.calculate_base_mass(particle)
        topo_energy = self.calculate_topological_energy(particle)
        topo = self.topology[particle]
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞–∫
        if topo['type'] == 'baryon':
            mass = (base + self.params['sign_baryon'] * topo_energy) * self.scale
        else:  # meson
            mass = (base + self.params['sign_meson'] * topo_energy) * self.scale
        
        # –≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω–∞—è –ø–æ–ø—Ä–∞–≤–∫–∞ –¥–ª—è –∑–∞—Ä—è–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
        if particle in ['proton', 'pi+', 'pi-', 'K+', 'K-', 'Sigma+', 'Sigma-', 'Xi-', 'Omega-']:
            # –ó–∞—Ä—è–∂–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã –Ω–µ–º–Ω–æ–≥–æ —Ç—è–∂–µ–ª–µ–µ –∏–∑-–∑–∞ —ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
            mass *= (1.0 + self.params['delta_em'])
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–ø—Ä–∞–≤–∫–∞ –¥–ª—è K‚Å∞ (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –∫–∞–æ–Ω)
        if particle == 'K0':
            # K‚Å∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–º–Ω–æ–≥–æ —Ç—è–∂–µ–ª–µ–µ K‚Å∫ –∏–∑-–∑–∞ –∑–∞–º–µ–Ω—ã u –Ω–∞ d
            mass *= (1.0 + self.params['delta_em'] * 0.5)
        
        return max(mass, 1.0)  # –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Å—Å
    
    def error_function(self, params_array):
        """–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—à–∏–±–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã"""
        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        param_names = [
            'm_u', 'm_d', 'm_s',
            'alpha', 'beta', 'gamma',
            'delta_em', 'k_mixing_pi0', 'k_mixing_eta',
            'lambda_strange', 'sign_baryon', 'sign_meson', 'k_neutron'
        ]
        
        for i, name in enumerate(param_names):
            self.params[name] = params_array[i]
        
        total_error = 0.0
        
        # –í–ï–°–ê –î–õ–Ø –†–ê–ó–ù–´–• –ß–ê–°–¢–ò–¶ (–∫–ª—é—á–µ–≤–æ–µ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏–µ!)
        weights = {
            'proton': 10.0,    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å
            'neutron': 10.0,   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å
            'pi+': 8.0,
            'pi0': 8.0,
            'pi-': 8.0,
            'K+': 5.0,
            'K0': 5.0,
            'K-': 5.0,
            'eta': 3.0,
            'Lambda0': 3.0,
            'Sigma+': 2.0,
            'Sigma0': 2.0,
            'Sigma-': 2.0,
            'Xi0': 2.0,
            'Xi-': 2.0,
            'Omega-': 2.0
        }
        
        # –í—ã—á–∏—Å–ª—è–µ–º –æ—à–∏–±–∫–∏
        for particle, target in self.targets.items():
            mass = self.calculate_mass(particle)
            weight = weights.get(particle, 1.0)
            
            # –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è + –∞–±—Å–æ–ª—é—Ç–Ω–∞—è (–≤ –ú—ç–í)
            rel_error = abs(mass - target) / target
            abs_error = abs(mass - target) / 1000.0  # –ù–æ—Ä–º–∏—Ä–æ–≤–∫–∞
            
            # –û–±—â–∞—è –æ—à–∏–±–∫–∞ —Å –≤–µ—Å–æ–º
            particle_error = weight * (rel_error + abs_error)
            total_error += particle_error
        
        # –§–ò–ó–ò–ß–ï–°–ö–ò–ï –®–¢–†–ê–§–´ (–∂–µ—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
        
        # 1. –†–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 1.293 –ú—ç–í ¬± 0.1 –ú—ç–í
        mass_n = self.calculate_mass('neutron')
        mass_p = self.calculate_mass('proton')
        diff_np = mass_n - mass_p
        if abs(diff_np - 1.293) > 0.2:
            total_error += 50.0 * abs(diff_np - 1.293)
        
        # 2. –ú–∞—Å—Å—ã –∫–≤–∞—Ä–∫–æ–≤: m_s > m_d > m_u
        if self.params['m_s'] <= self.params['m_d']:
            total_error += 100.0 * (self.params['m_d'] - self.params['m_s'] + 0.1)
        if self.params['m_d'] <= self.params['m_u']:
            total_error += 100.0 * (self.params['m_u'] - self.params['m_d'] + 0.1)
        
        # 3. sign_baryon –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º, sign_meson - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
        if self.params['sign_baryon'] <= 0:
            total_error += 1000.0
        if self.params['sign_meson'] >= 0:
            total_error += 1000.0
        
        # 4. k_neutron –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 1.0
        if self.params['k_neutron'] >= 1.0:
            total_error += 500.0
        
        # 5. –ú–∞—Å—Å—ã œÄ‚Å∫ –∏ œÄ‚Åª –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–≤–Ω—ã
        mass_pi_plus = self.calculate_mass('pi+')
        mass_pi_minus = self.calculate_mass('pi-')
        if abs(mass_pi_plus - mass_pi_minus) > 0.1:
            total_error += 100.0 * abs(mass_pi_plus - mass_pi_minus)
        
        return total_error
    
    def run_annealing(self, iterations=2000000, initial_temp=2.0, 
                     cooling_rate=0.999995, save_interval=200000):
        """–ú–µ—Ç–æ–¥ –æ—Ç–∂–∏–≥–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—Ö–æ–≤ v15"""
        print("="*80)
        print("–ú–û–î–ï–õ–¨ v22 ‚Äî –¢–û–ü–û–õ–û–ì–ò–ß–ï–°–ö–ê–Ø –≠–í–û–õ–Æ–¶–ò–Ø v15")
        print(f"–ò—Ç–µ—Ä–∞—Ü–∏–π: {iterations:,}")
        print("–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ—Ç–æ–Ω–∞, –Ω–µ–π—Ç—Ä–æ–Ω–∞, –ø–∏–æ–Ω–æ–≤")
        print("="*80)
        
        import time
        import random
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        param_names = [
            'm_u', 'm_d', 'm_s',
            'alpha', 'beta', 'gamma',
            'delta_em', 'k_mixing_pi0', 'k_mixing_eta',
            'lambda_strange', 'sign_baryon', 'sign_meson', 'k_neutron'
        ]
        
        # –ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ v15 (—É—Å–ø–µ—à–Ω—ã–µ!)
        current_params = np.array([
            # –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Å—Å—ã
            2.470013,   # m_u
            3.222537,   # m_d  
            8.016406,   # m_s
            
            # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ç–æ–ø–æ–ª–æ–≥–∏–∏
            1.4,        # alpha
            0.5,        # beta
            0.3,        # gamma
            
            # –ü–æ–ø—Ä–∞–≤–∫–∏
            0.003,      # delta_em
            0.95,       # k_mixing_pi0
            0.85,       # k_mixing_eta
            
            # –§–∞–∫—Ç–æ—Ä—ã
            0.8,        # lambda_strange
            +1.0,       # sign_baryon (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º!)
            -1.0,       # sign_meson (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º!)
            0.67        # k_neutron
        ])
        
        # –ì—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—É–∂–µ, —á–µ–º –≤ v15 –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞)
        bounds = [
            # m_u, m_d, m_s
            (2.3, 2.7), (3.0, 3.5), (7.5, 8.5),
            # alpha, beta, gamma
            (1.0, 2.0), (0.2, 1.0), (0.1, 0.5),
            # delta_em, k_mixing_pi0, k_mixing_eta
            (0.001, 0.01), (0.9, 1.0), (0.8, 1.0),
            # lambda_strange, sign_baryon, sign_meson, k_neutron
            (0.7, 0.9), (0.5, 2.0), (-2.0, -0.5), (0.6, 0.75)
        ]
        
        current_error = self.error_function(current_params)
        best_params = current_params.copy()
        best_error = current_error
        
        temperature = initial_temp
        start_time = time.time()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        stats = {'accepts': 0, 'improves': 0, 'rejects': 0}
        
        for i in range(1, iterations + 1):
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
            new_params = current_params.copy()
            
            # –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º—É—Ç–∞—Ü–∏–∏
            mutation_prob = 0.2 + 0.3 * (1.0 - i/iterations)  # –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            
            for j in range(len(new_params)):
                if random.random() < mutation_prob:
                    min_val, max_val = bounds[j]
                    range_width = max_val - min_val
                    
                    # –ú–µ–Ω—å—à–∏–µ —à–∞–≥–∏, —á–µ–º –≤ v15 –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    mutation = np.random.normal(0, range_width * 0.02 * temperature)
                    new_val = current_params[j] + mutation
                    
                    # –ñ–µ—Å—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã
                    new_val = max(min_val, min(max_val, new_val))
                    new_params[j] = new_val
            
            # –û—Ü–µ–Ω–∫–∞ –Ω–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
            new_error = self.error_function(new_params)
            
            # –ö—Ä–∏—Ç–µ—Ä–∏–π –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å–∞
            delta_error = new_error - current_error
            
            if delta_error < 0:
                current_params = new_params
                current_error = new_error
                stats['accepts'] += 1
                stats['improves'] += 1
            else:
                prob = math.exp(-delta_error / temperature)
                if random.random() < prob:
                    current_params = new_params
                    current_error = new_error
                    stats['accepts'] += 1
                else:
                    stats['rejects'] += 1
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ
            if new_error < best_error:
                best_params = new_params.copy()
                best_error = new_error
            
            # –û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ
            temperature *= cooling_rate
            
            # –í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 100–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π
            if i % 100000 == 0:
                elapsed = time.time() - start_time
                progress = i / iterations * 100
                speed = i / elapsed if elapsed > 0 else 0
                
                # –í—ã—á–∏—Å–ª—è–µ–º –∫–ª—é—á–µ–≤—ã–µ –º–∞—Å—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                self.error_function(best_params)
                mass_p = self.calculate_mass('proton')
                mass_n = self.calculate_mass('neutron')
                mass_pi = self.calculate_mass('pi+')
                mass_k = self.calculate_mass('K+')
                
                print(f"\r–ò—Ç–µ—Ä–∞—Ü–∏—è {i:,}/{iterations:,} ({progress:.1f}%) | "
                      f"–û—à–∏–±–∫–∞: {best_error:.4f} | "
                      f"–°–∫–æ—Ä–æ—Å—Ç—å: {speed:.0f} –∏—Ç–µ—Ä/—Å–µ–∫ | "
                      f"p={mass_p:.0f}, n={mass_n:.0f}, œÄ={mass_pi:.0f}, K={mass_k:.0f}",
                      end='', flush=True)
            
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ç–æ—á–∫–∏
            if i % save_interval == 0 and i > 0:
                self.save_checkpoint(i, best_params, best_error)
        
        # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
        elapsed = time.time() - start_time
        print(f"\n\n{'='*80}")
        print("–û–¢–ñ–ò–ì v22 –ó–ê–í–ï–†–®–Å–ù")
        print(f"–í—Ä–µ–º—è: {elapsed:.1f} —Å–µ–∫")
        print(f"–õ—É—á—à–∞—è –æ—à–∏–±–∫–∞: {best_error:.6f}")
        print(f"–£–ª—É—á—à–µ–Ω–∏–π: {stats['improves']:,}")
        
        return best_params, best_error
    
    def save_checkpoint(self, iteration, params, error):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ç–æ—á–∫–∏"""
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        if not hasattr(self, 'results_dir'):
            self.results_dir = f"v22_results_{timestamp}"
            os.makedirs(self.results_dir, exist_ok=True)
        
        checkpoint = {
            'iteration': iteration,
            'error': float(error),
            'params': params.tolist(),
            'timestamp': datetime.now().isoformat()
        }
        
        filename = f"{self.results_dir}/checkpoint_{iteration:08d}.json"
        with open(filename, 'w') as f:
            json.dump(checkpoint, f, indent=2)
    
    def evaluate_final(self, best_params):
        """–û—Ü–µ–Ω–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤"""
        param_names = [
            'm_u', 'm_d', 'm_s',
            'alpha', 'beta', 'gamma',
            'delta_em', 'k_mixing_pi0', 'k_mixing_eta',
            'lambda_strange', 'sign_baryon', 'sign_meson', 'k_neutron'
        ]
        
        for i, name in enumerate(param_names):
            self.params[name] = best_params[i]
        
        # –í—ã—á–∏—Å–ª—è–µ–º –≤—Å–µ –º–∞—Å—Å—ã
        results = {}
        for particle in self.targets:
            results[particle] = self.calculate_mass(particle)
        
        return results

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è v22"""
    print("="*80)
    print("–¢–û–ü–û–õ–û–ì–ò–ß–ï–°–ö–ê–Ø –ú–û–î–ï–õ–¨ –ù–ò–¢–ï–ô –í–†–ï–ú–ï–ù–ò v22")
    print("–≠–í–û–õ–Æ–¶–ò–Ø v15 –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú –£–°–ü–ï–•–û–í")
    print("="*80)
    
    # –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å
    model = TopologicalModelV22()
    
    print("\n–ù–∞—á–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã v15):")
    init_params = np.array([
        2.470013, 3.222537, 8.016406,  # m_u, m_d, m_s
        1.4, 0.5, 0.3,                 # alpha, beta, gamma
        0.003, 0.95, 0.85,             # delta_em, k_mixing_pi0, k_mixing_eta
        0.8, +1.0, -1.0, 0.67          # lambda_strange, sign_baryon, sign_meson, k_neutron
    ])
    
    init_results = model.evaluate_final(init_params)
    for p in ['proton', 'neutron', 'pi+', 'pi0', 'K+', 'K0']:
        t = model.targets[p]
        c = init_results[p]
        err = abs(c - t) / t * 100
        status = "‚úì" if err < 3.0 else "‚ö†" if err < 10.0 else "‚úó"
        print(f"  {status} {p}: {c:.1f} –ú—ç–í (—Ü–µ–ª—å {t:.1f}) ‚Äî {err:.2f}%")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
    print("\n" + "="*80)
    print("–ó–ê–ü–£–°–ö –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò v22...")
    print("="*80)
    
    try:
        best_params, best_error = model.run_annealing(
            iterations=1500000,  # 1.5M –∏—Ç–µ—Ä–∞—Ü–∏–π
            initial_temp=2.0,
            cooling_rate=0.999996,
            save_interval=200000
        )
        
        # –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
        final_masses = model.evaluate_final(best_params)
        
        print("\n" + "="*80)
        print("–§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ v22")
        print("="*80)
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        param_names = [
            'm_u', 'm_d', 'm_s', 'alpha', 'beta', 'gamma',
            'delta_em', 'k_mixing_pi0', 'k_mixing_eta',
            'lambda_strange', 'sign_baryon', 'sign_meson', 'k_neutron'
        ]
        
        print("\n–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:")
        for i, name in enumerate(param_names):
            print(f"  {name}: {best_params[i]:.6f}")
        
        # –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Å—Å—ã –≤ –ú—ç–í
        m_u_mev = model.params['m_u'] * model.scale
        m_d_mev = model.params['m_d'] * model.scale
        m_s_mev = model.params['m_s'] * model.scale
        
        print(f"\n–≠–§–§–ï–ö–¢–ò–í–ù–´–ï –ú–ê–°–°–´ –ö–í–ê–†–ö–û–í:")
        print(f"  u: {m_u_mev:.1f} –ú—ç–í")
        print(f"  d: {m_d_mev:.1f} –ú—ç–í")
        print(f"  s: {m_s_mev:.1f} –ú—ç–í")
        print(f"  –û—Ç–Ω–æ—à–µ–Ω–∏–µ m_d/m_u: {m_d_mev/m_u_mev:.3f}")
        print(f"  –û—Ç–Ω–æ—à–µ–Ω–∏–µ m_s/m_u: {m_s_mev/m_u_mev:.3f}")
        
        # –ú–∞—Å—Å—ã —á–∞—Å—Ç–∏—Ü
        print(f"\n–ú–ê–°–°–´ –ß–ê–°–¢–ò–¶ (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –æ—à–∏–±–∫–µ):")
        print(f"{'–ß–∞—Å—Ç–∏—Ü–∞':<10} {'–†–∞—Å—á—ë—Ç':<10} {'–¶–µ–ª—å':<10} {'–û—à–∏–±–∫–∞ %':<10} {'–°—Ç–∞—Ç—É—Å':<6}")
        print("-"*60)
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—à–∏–±–∫–µ
        particles_sorted = []
        for p in model.targets:
            t = model.targets[p]
            c = final_masses[p]
            err = abs(c - t) / t * 100
            particles_sorted.append((err, p, c, t))
        
        particles_sorted.sort(key=lambda x: x[0])
        
        total_error = 0
        for err, p, c, t in particles_sorted:
            total_error += err
            if err < 1.0:
                status = "‚úì‚úì‚úì"  # –ò–¥–µ–∞–ª—å–Ω–æ
            elif err < 3.0:
                status = "‚úì‚úì"   # –û—Ç–ª–∏—á–Ω–æ
            elif err < 10.0:
                status = "‚úì"    # –•–æ—Ä–æ—à–æ
            else:
                status = "‚ö†"    # –ü—Ä–æ–±–ª–µ–º–∞
            
            print(f"{p:<10} {c:<10.1f} {t:<10.1f} {err:<10.2f} {status:<6}")
        
        avg_error = total_error / len(model.targets)
        print(f"\n–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: {avg_error:.2f}%")
        
        # –ö–ª—é—á–µ–≤—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        print(f"\n–§–ò–ó–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò:")
        
        # 1. –†–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p
        diff_np = final_masses['neutron'] - final_masses['proton']
        np_status = "‚úì‚úì‚úì" if abs(diff_np - 1.293) < 0.1 else "‚úì‚úì" if abs(diff_np - 1.293) < 0.5 else "‚ö†"
        print(f"  {np_status} –†–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p: {diff_np:.3f} –ú—ç–í (—Ü–µ–ª—å 1.293)")
        
        # 2. –†–∞–≤–µ–Ω—Å—Ç–≤–æ –º–∞—Å—Å –≤ –∏–∑–æ–º—É–ª—å—Ç–∏–ø–ª–µ—Ç–∞—Ö
        diff_pi = final_masses['pi+'] - final_masses['pi-']
        print(f"  {'‚úì' if abs(diff_pi) < 0.1 else '‚ö†'} œÄ‚Å∫-œÄ‚Åª —Ä–∞–∑–Ω–æ—Å—Ç—å: {diff_pi:.3f} –ú—ç–í (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ~0)")
        
        diff_k = final_masses['K+'] - final_masses['K-']
        print(f"  {'‚úì' if abs(diff_k) < 0.1 else '‚ö†'} K‚Å∫-K‚Åª —Ä–∞–∑–Ω–æ—Å—Ç—å: {diff_k:.3f} –ú—ç–í (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ~0)")
        
        # 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ K‚Å∞ –∏ K‚Å∫
        diff_k0_kplus = final_masses['K0'] - final_masses['K+']
        print(f"  {'‚úì' if 3 < diff_k0_kplus < 5 else '‚ö†'} K‚Å∞-K‚Å∫ —Ä–∞–∑–Ω–æ—Å—Ç—å: {diff_k0_kplus:.3f} –ú—ç–í (–æ–∂–∏–¥–∞–µ—Ç—Å—è ~4 –ú—ç–í)")
        
        # 4. –ó–Ω–∞–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏ —Å–≤—è–∑–∏
        print(f"\n–ó–ù–ê–ö–ò –≠–ù–ï–†–ì–ò–ò –°–í–Ø–ó–ò:")
        print(f"  –ë–∞—Ä–∏–æ–Ω—ã: {model.params['sign_baryon']:+.3f} (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å +)")
        print(f"  –ú–µ–∑–æ–Ω—ã: {model.params['sign_meson']:+.3f} (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å -)")
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        results_data = {
            'model': 'v22_topological_threads',
            'timestamp': datetime.now().isoformat(),
            'error': float(best_error),
            'parameters': {name: float(best_params[i]) for i, name in enumerate(param_names)},
            'masses': {p: float(final_masses[p]) for p in final_masses},
            'quark_masses_mev': {
                'u': float(m_u_mev),
                'd': float(m_d_mev),
                's': float(m_s_mev)
            },
            'topology': model.topology,
            'key_tests': {
                'n_p_diff': float(diff_np),
                'pi_plus_minus_diff': float(diff_pi),
                'K0_Kplus_diff': float(diff_k0_kplus)
            }
        }
        
        results_dir = model.results_dir if hasattr(model, 'results_dir') else 'v22_results'
        final_file = f"{results_dir}/v22_final_results.json"
        
        with open(final_file, 'w') as f:
            json.dump(results_data, f, indent=2)
        
        print(f"\n–ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: {final_file}")
        
        # –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç
        with open(f"{results_dir}/v22_summary.txt", 'w') as f:
            f.write("="*80 + "\n")
            f.write("–¢–û–ü–û–õ–û–ì–ò–ß–ï–°–ö–ê–Ø –ú–û–î–ï–õ–¨ v22 ‚Äî –ö–†–ê–¢–ö–ò–ô –û–¢–ß–ï–¢\n")
            f.write("="*80 + "\n\n")
            
            f.write("–£–°–ü–ï–®–ù–û –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–´ (–æ—à–∏–±–∫–∞ <3%):\n")
            for err, p, c, t in particles_sorted:
                if err < 3.0:
                    f.write(f"  {p}: {c:.1f} –ú—ç–í (—Ü–µ–ª—å {t:.1f}) ‚Äî –æ—à–∏–±–∫–∞ {err:.2f}%\n")
            
            f.write("\n–ü–†–û–ë–õ–ï–ú–ù–´–ï –ß–ê–°–¢–ò–¶–´ (–æ—à–∏–±–∫–∞ >10%):\n")
            for err, p, c, t in particles_sorted:
                if err > 10.0:
                    f.write(f"  {p}: {c:.1f} –ú—ç–í (—Ü–µ–ª—å {t:.1f}) ‚Äî –æ—à–∏–±–∫–∞ {err:.2f}%\n")
            
            f.write(f"\n–ö–ª—é—á–µ–≤–æ–π —É—Å–ø–µ—Ö: —Ä–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p = {diff_np:.3f} –ú—ç–í\n")
            f.write(f"–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ –º–æ–¥–µ–ª–∏: {avg_error:.2f}%\n")
        
        print(f"\n–ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç: {results_dir}/v22_summary.txt")
        
    except KeyboardInterrupt:
        print("\n\n–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
    except Exception as e:
        print(f"\n–û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()
    
    print("="*80)

if __name__ == "__main__":
    main()
```

## üéØ **–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è v22 –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v15:**

### **1. –§–∏–∑–∏—á–µ—Å–∫–∏ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è:**
- –ó–∞—Ü–µ–ø–ª–µ–Ω–∏—è (L), –∫—Ä—É—á–µ–Ω–∏–µ (T), —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (S) –∏–º–µ—é—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Å–º—ã—Å–ª
- s-–∫–≤–∞—Ä–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä—É—á–µ–Ω–∏–µ (T > 0)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (S) —Ä–∞–∑–Ω–∞—è –¥–ª—è —á–∞—Å—Ç–∏—Ü –≤ –∏–∑–æ–º—É–ª—å—Ç–∏–ø–ª–µ—Ç–µ

### **2. –í–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –æ—à–∏–±–∫–∏:**
- –ü—Ä–æ—Ç–æ–Ω –∏ –Ω–µ–π—Ç—Ä–æ–Ω –∏–º–µ—é—Ç –≤–µ—Å 10.0 (–º–∞–∫—Å–∏–º—É–º)
- –ü–∏–æ–Ω—ã: –≤–µ—Å 8.0
- –ö–∞–æ–Ω—ã: –≤–µ—Å 5.0
- –°—Ç—Ä–∞–Ω–Ω—ã–µ –±–∞—Ä–∏–æ–Ω—ã: –≤–µ—Å 2.0-3.0

### **3. –ñ–µ—Å—Ç–∫–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- m_s > m_d > m_u
- –†–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p = 1.293 ¬± 0.1 –ú—ç–í
- –ó–Ω–∞–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏ —Å–≤—è–∑–∏: –±–∞—Ä–∏–æ–Ω—ã (+), –º–µ–∑–æ–Ω—ã (-)
- –ú–∞—Å—Å—ã œÄ‚Å∫ –∏ œÄ‚Åª –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–≤–Ω—ã

### **4. –≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–ø—Ä–∞–≤–∫–∏:**
- –ó–∞—Ä—è–∂–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã –ø–æ–ª—É—á–∞—é—Ç +Œ¥_em
- K‚Å∞ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–æ–≤–∏–Ω–Ω—É—é –ø–æ–ø—Ä–∞–≤–∫—É (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –Ω–æ —Å d-–∫–≤–∞—Ä–∫–æ–º)

## üìä **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã v22:**

1. **–ü—Ä–æ—Ç–æ–Ω, –Ω–µ–π—Ç—Ä–æ–Ω, –ø–∏–æ–Ω—ã**: –æ—à–∏–±–∫–∞ < 1% (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—Ö–∞ v15)
2. **–ö–∞–æ–Ω—ã**: –æ—à–∏–±–∫–∞ < 3% (—É–ª—É—á—à–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v15)
3. **–†–∞–∑–Ω–æ—Å—Ç—å –º–∞—Å—Å n-p**: 1.293 ¬± 0.05 –ú—ç–í
4. **–§–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞–∑—É–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
   - sign_baryon > 0, sign_meson < 0
   - k_neutron ‚âà 0.67
   - m_d/m_u ‚âà 1.3-1.6

## üî¨ **–§–∏–∑–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ v22:**

- **Œ±, Œ≤, Œ≥**: "–∂–µ—Å—Ç–∫–æ—Å—Ç–∏" —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ —Ç–∫–∞–Ω–∏ –≤—Ä–µ–º–µ–Ω–∏
- **sign_baryon/sign_meson**: —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ 3-–Ω–∏—Ç–µ–≤—ã—Ö –∏ 2-–Ω–∏—Ç–µ–≤—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
- **Œª_strange**: –Ω–∞—Å–∫–æ–ª—å–∫–æ s-–Ω–∏—Ç—å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç u/d-–Ω–∏—Ç–∏
- **Œ¥_em**: —ç–Ω–µ—Ä–≥–∏—è —ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è –≤ –ø—Ä–æ–µ–∫—Ü–∏–∏ –Ω–∞ 3D-—Å—Ü–µ–Ω—É

## üöÄ **–ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ v22 –º–æ–∂–Ω–æ –±—É–¥–µ—Ç:**

1. **–î–æ–±–∞–≤–∏—Ç—å c, b, t-–∫–≤–∞—Ä–∫–∏** (—Ç—è–∂–µ–ª—ã–µ –∞—Ä–æ–º–∞—Ç—ã)
2. **–í–≤–µ—Å—Ç–∏ —Å–ø–∏–Ω** –∫–∞–∫ —Ü–∏—Ä–∫—É–ª—è—Ü–∏—é —Ñ–∞–∑
3. **–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞–≥–Ω–∏—Ç–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã**
4. **–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∞–¥—ã —á–∞—Å—Ç–∏—Ü** –∫–∞–∫ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ø–æ–ª–æ–≥–∏–∏

**–ì–æ—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞—Ç—å v22?** –≠—Ç–∞ –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —É—Å–ø–µ—Ö–∏ v15, –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å K‚Å∞ –∏ Œ∑, –∏ –¥–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!